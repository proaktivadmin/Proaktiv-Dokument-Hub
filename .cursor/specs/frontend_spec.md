# FRONTEND SPECIFICATION - V3.2 Document Hub

**Generated by:** Frontend Architect Agent  
**Date:** 2026-01-17 (Updated 2026-01-22)  
**Phase:** 3.2 (Stack Upgraded, CI/CD Active)

---

## EXECUTIVE SUMMARY

This specification defines the frontend architecture for V3.0+ features, building upon the existing production system. The implementation adds organizational management (offices, employees), company assets with scoped storage, territory mapping, enhanced Vitec categories, and system template versioning.

> **Note:** Stack upgraded on 2026-01-22: Next.js 16.1.4, React 19.2.3, Tailwind 4.1.18, TypeScript 5.9.3, Vitest in CI

### Current Frontend State (V3.2) - PRODUCTION LIVE

| Component | Status | Notes |
|-----------|--------|-------|
| Next.js 16 App Router | âœ… | Server + Client Components (upgraded from 14) |
| React 19 | âœ… | Upgraded from 18 |
| Tailwind CSS 4 | âœ… | Upgraded from 3 |
| TypeScript 5.9 | âœ… | Upgraded from 5.3 |
| Vitest Testing | âœ… | 4 tests passing |
| Shadcn/UI Components | âœ… | Full design system |
| Shelf-based Template Library | âœ… | Grouped by channel |
| 4-Tab Template Viewer | âœ… | Preview, Code, Settings, Simulator |
| Flettekoder (Merge Fields) Page | âœ… | Search, categories, code generator |
| Storage Browser | âœ… | WebDAV integration |
| Authentication | âœ… | JWT sessions, login page |
| Dashboard | âœ… | Stats + Inventory sync status |

### Target State (V3.0)

1. **Office & Employee Hub** - Full company CRM UI with lifecycle management
2. **Company Assets** - Scoped file storage with gallery views
3. **Territory Map** - Interactive Norway heatmap with layer toggles
4. **Enhanced Categories** - 97 Vitec categories with vitec_id
5. **System Template Versioning** - Version history UI and restore functionality

---

## NEW PAGES

### Page 1: `/offices` - Office Directory

**Purpose:** Display and manage all office locations with employee counts and status.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (existing)                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Breadcrumb: Dashboard > Kontorer                                â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ” SÃ¸k kontorer...     â”‚  â”‚ Filter: By   â–¼â”‚  â”‚ + Nytt kontorâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Office Grid (3 columns)                                      â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚ â”‚
â”‚ â”‚ â”‚ STAV      â”‚ â”‚ SANDNES   â”‚ â”‚ OSLO      â”‚                   â”‚ â”‚
â”‚ â”‚ â”‚ Stavanger â”‚ â”‚ Sandnes   â”‚ â”‚ Oslo      â”‚                   â”‚ â”‚
â”‚ â”‚ â”‚ ğŸŸ¢ Active â”‚ â”‚ ğŸŸ¢ Active â”‚ â”‚ ğŸŸ¡ Setup  â”‚                   â”‚ â”‚
â”‚ â”‚ â”‚ 8 ansatte â”‚ â”‚ 5 ansatte â”‚ â”‚ 2 ansatte â”‚                   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Component: `OfficeCard.tsx`

```typescript
interface OfficeCardProps {
  office: Office;
  employeeCount: number;
  onClick: () => void;
  onEdit?: () => void;
}

// Displays:
// - Office name and short_code badge
// - City location
// - Status indicator (active/inactive)
// - Employee count
// - Quick action menu (edit, view, deactivate)
```

#### Component: `OfficeGrid.tsx`

```typescript
interface OfficeGridProps {
  offices: Office[];
  isLoading: boolean;
  onOfficeClick: (office: Office) => void;
  onCreateNew: () => void;
}

// Features:
// - Responsive 1/2/3 column grid
// - Loading skeleton
// - Empty state with CTA
// - Filter by city
// - Search by name/short_code
```

---

### Page 2: `/offices/[id]` - Office Detail

**Purpose:** Full office profile with employees, assets, territory, and external listings.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Breadcrumb: Dashboard > Kontorer > Proaktiv Stavanger           â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Office Header                                                â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  Proaktiv Stavanger            [Rediger] [Deaktiver]â”‚ â”‚
â”‚ â”‚ â”‚ LOGO â”‚  Stavanger | ğŸŸ¢ Aktiv                               â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”˜  âœ‰ stavanger@proaktiv.no | ğŸ“ 51 00 00 00          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Tabs: [Ansatte] [Filer] [MarkedsomrÃ¥de] [Eksterne lenker]   â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ TabContent (Ansatte):                                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚ â”‚ â”‚ + Ny ansatt                          Filter: Status â–¼     â”‚â”‚ â”‚
â”‚ â”‚ â”‚                                                           â”‚â”‚ â”‚
â”‚ â”‚ â”‚ Employee Grid (similar to office grid)                    â”‚â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ Photo   â”‚ â”‚ Photo   â”‚ â”‚ Photo   â”‚                      â”‚â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ Name    â”‚ â”‚ Name    â”‚ â”‚ Name    â”‚                      â”‚â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ Title   â”‚ â”‚ Title   â”‚ â”‚ Title   â”‚                      â”‚â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ ğŸŸ¢ Aktivâ”‚ â”‚ ğŸŸ¡ Onb. â”‚ â”‚ ğŸ”´ Off. â”‚                      â”‚â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Tabs

| Tab | Component | Content |
|-----|-----------|---------|
| Ansatte | `EmployeeGrid` | Employees at this office |
| Filer | `AssetGallery` | Office-scoped assets |
| MarkedsomrÃ¥de | `TerritoryMiniMap` | Postal codes this office covers |
| Eksterne lenker | `ExternalListingTable` | Third-party directory listings |

---

### Page 3: `/employees` - Employee Directory

**Purpose:** Company-wide employee view with office filtering.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Breadcrumb: Dashboard > Ansatte                                  â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Office Sidebar â”‚ â”‚ Employee Grid                           â”‚ â”‚
â”‚ â”‚                â”‚ â”‚                                          â”‚ â”‚
â”‚ â”‚ Alle kontorer  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚ â”‚ Avatar  â”‚ â”‚ Avatar  â”‚ â”‚ Avatar  â”‚    â”‚ â”‚
â”‚ â”‚ â—‹ Stavanger (8)â”‚ â”‚ â”‚ Per     â”‚ â”‚ Kari    â”‚ â”‚ Ole     â”‚    â”‚ â”‚
â”‚ â”‚ â—‹ Sandnes (5)  â”‚ â”‚ â”‚ Megler  â”‚ â”‚ Megler  â”‚ â”‚ OppgjÃ¸r â”‚    â”‚ â”‚
â”‚ â”‚ â—‹ Oslo (2)     â”‚ â”‚ â”‚ ğŸŸ¢ Aktivâ”‚ â”‚ ğŸŸ¢ Aktivâ”‚ â”‚ ğŸŸ¡ Onb. â”‚    â”‚ â”‚
â”‚ â”‚                â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚ â”‚ Filter: Status â”‚ â”‚                                          â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚                                          â”‚ â”‚
â”‚ â”‚ â˜‘ Aktiv       â”‚ â”‚                                          â”‚ â”‚
â”‚ â”‚ â˜‘ Onboarding  â”‚ â”‚                                          â”‚ â”‚
â”‚ â”‚ â˜ Offboarding â”‚ â”‚                                          â”‚ â”‚
â”‚ â”‚ â˜ Inaktiv     â”‚ â”‚                                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Component: `EmployeeSidebar.tsx`

```typescript
interface EmployeeSidebarProps {
  offices: Office[];
  selectedOfficeId: string | null;
  statusFilters: EmployeeStatus[];
  onOfficeSelect: (officeId: string | null) => void;
  onStatusToggle: (status: EmployeeStatus) => void;
}

// Features:
// - Office list with employee counts
// - Multi-select status checkboxes
// - Collapsible sections
```

#### Component: `EmployeeCard.tsx`

```typescript
interface EmployeeCardProps {
  employee: Employee;
  officeName: string;
  onClick: () => void;
  onStartChecklist?: () => void;
}

// Displays:
// - Avatar placeholder (initials or photo)
// - Full name
// - Title
// - Status badge with color
// - Office name (if viewing all)
// - Days until end_date (if offboarding)
```

---

### Page 4: `/employees/[id]` - Employee Profile

**Purpose:** Full employee profile with lifecycle management.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Breadcrumb: Dashboard > Ansatte > Per Hansen                    â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Profile Header                                               â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚ â”‚
â”‚ â”‚ â”‚ AVATAR   â”‚  Per Hansen          [Rediger] [Start offboard.]â”‚ â”‚
â”‚ â”‚ â”‚   PH     â”‚  Eiendomsmegler MNEF                            â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Proaktiv Stavanger | ğŸŸ¢ Aktiv siden 01.01.2020 â”‚ â”‚
â”‚ â”‚               âœ‰ per@proaktiv.no | ğŸ“ 912 34 567              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Tabs: [Oversikt] [Filer] [Sjekklister] [Eksterne lenker]    â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ TabContent (Oversikt):                                       â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚ â”‚ â”‚ Kontaktinfo            â”‚ â”‚ Nettsider              â”‚       â”‚ â”‚
â”‚ â”‚ â”‚ E-post: per@...        â”‚ â”‚ ğŸ”— Hjemmeside profil   â”‚       â”‚ â”‚
â”‚ â”‚ â”‚ Telefon: 912 34 567    â”‚ â”‚ ğŸ”— LinkedIn            â”‚       â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚ â”‚ â”‚ Ansettelsesforhold                                       â”‚â”‚ â”‚
â”‚ â”‚ â”‚ Startdato: 01.01.2020                                    â”‚â”‚ â”‚
â”‚ â”‚ â”‚ Status: Aktiv                                            â”‚â”‚ â”‚
â”‚ â”‚ â”‚ Kontor: Proaktiv Stavanger                               â”‚â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Offboarding Mode

When `status === 'offboarding'`, show additional panel:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ Offboarding i gang                                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Sluttdato: 31.03.2026                                          â”‚
â”‚ Skjules fra hjemmeside: 15.03.2026                             â”‚
â”‚ Slett data: 30.04.2026                                         â”‚
â”‚                                                                 â”‚
â”‚ Sjekkliste: 3/7 fullfÃ¸rt                â”â”â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ â”‚
â”‚                                                                 â”‚
â”‚ [Se full sjekkliste â†’]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Page 5: `/assets` - Global Asset Gallery

**Purpose:** Browse all company-wide assets with category filtering.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Breadcrumb: Dashboard > Filer                                   â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Tabs: [Globalt] [Per kontor] [Per ansatt]                   â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ Category Filter:                                             â”‚ â”‚
â”‚ â”‚ [Alle] [Logo] [Foto] [MarkedsfÃ¸ring] [Dokumenter]           â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ Asset Grid:                                  [+ Last opp fil]â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â”‚
â”‚ â”‚ â”‚ ğŸ–¼      â”‚ â”‚ ğŸ–¼      â”‚ â”‚ ğŸ“„      â”‚ â”‚ ğŸ–¼      â”‚            â”‚ â”‚
â”‚ â”‚ â”‚ Logo    â”‚ â”‚ Logo    â”‚ â”‚ Brosjyreâ”‚ â”‚ Banner  â”‚            â”‚ â”‚
â”‚ â”‚ â”‚ Primary â”‚ â”‚ White   â”‚ â”‚ PDF     â”‚ â”‚ Web     â”‚            â”‚ â”‚
â”‚ â”‚ â”‚ 245 KB  â”‚ â”‚ 180 KB  â”‚ â”‚ 2.1 MB  â”‚ â”‚ 890 KB  â”‚            â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Component: `AssetGallery.tsx`

```typescript
interface AssetGalleryProps {
  scope: 'global' | 'office' | 'employee';
  scopeId?: string; // office_id or employee_id
  category?: AssetCategory;
  onUpload: (file: File, metadata: AssetMetadata) => Promise<void>;
  onDownload: (asset: CompanyAsset) => void;
  onDelete: (asset: CompanyAsset) => void;
}

// Features:
// - Grid view with thumbnails for images
// - File type icons for documents
// - Drag-and-drop upload
// - Category tabs
// - Download/delete actions
// - Metadata popup on hover
```

#### Component: `AssetUploadDialog.tsx`

```typescript
interface AssetUploadDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  scope: 'global' | 'office' | 'employee';
  scopeId?: string;
  onSuccess: () => void;
}

// Form fields:
// - File dropzone (react-dropzone)
// - Display name
// - Category selector
// - Alt text (for images)
// - Usage notes
```

---

### Page 6: `/territories` - Territory Map (MarkedsomrÃ¥de)

**Purpose:** Interactive heatmap of postal code allocations.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Breadcrumb: Dashboard > MarkedsomrÃ¥de                           â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Layer Controls           â”‚ â”‚ Interactive Map (Leaflet)      â”‚ â”‚
â”‚ â”‚                          â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ Lag:                     â”‚ â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚ â˜‘ Vitec Next (master)   â”‚ â”‚     â”‚   â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ   â”‚  â”‚ â”‚
â”‚ â”‚ â˜ Finn.no               â”‚ â”‚     â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚  â”‚ â”‚
â”‚ â”‚ â˜ Anbudstjenester       â”‚ â”‚     â”‚   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   â”‚  â”‚ â”‚
â”‚ â”‚ â˜ Hjemmeside            â”‚ â”‚     â”‚     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚  â”‚ â”‚
â”‚ â”‚ â˜‘ Svarteliste           â”‚ â”‚     â”‚       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       â”‚  â”‚ â”‚
â”‚ â”‚                          â”‚ â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â”‚ Kontorer:                â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ â— Stavanger (#4A90D9)   â”‚ â”‚  Legend:                        â”‚ â”‚
â”‚ â”‚ â— Sandnes (#E67E22)     â”‚ â”‚  â— Stavanger  â— Sandnes         â”‚ â”‚
â”‚ â”‚ â— Oslo (#9B59B6)        â”‚ â”‚  â— Oslo       â¬› Svartelistet    â”‚ â”‚
â”‚ â”‚                          â”‚ â”‚                                 â”‚ â”‚
â”‚ â”‚ [Importer postnumre â†’]  â”‚ â”‚                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Postal Code Table (below map)                                â”‚ â”‚
â”‚ â”‚ Postnr | Poststed    | Kontor    | Kilde     | Prioritet   â”‚ â”‚
â”‚ â”‚ 4000   | Stavanger   | Stavanger | vitec_next| 1           â”‚ â”‚
â”‚ â”‚ 4001   | Stavanger   | Stavanger | vitec_next| 1           â”‚ â”‚
â”‚ â”‚ ...                                                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Component: `TerritoryMap.tsx`

```typescript
interface TerritoryMapProps {
  territories: OfficeTerritory[];
  offices: Office[];
  activeLayers: TerritorySource[];
  showBlacklist: boolean;
  onPostalCodeClick: (postalCode: string) => void;
  onLayerToggle: (source: TerritorySource) => void;
}

// Dependencies:
// - react-leaflet for map rendering
// - GeoJSON for Norway postal code boundaries
// - Office colors for heatmap fill

// Features:
// - Click postal code to see details
// - Zoom to office territories
// - Layer toggle visibility
// - Blacklisted areas shown in dark gray
```

#### Component: `PostalCodeTable.tsx`

```typescript
interface PostalCodeTableProps {
  territories: OfficeTerritoryWithDetails[];
  onEdit: (territory: OfficeTerritory) => void;
  onBlacklist: (postalCode: string) => void;
}

// Columns:
// - Postal code (sortable)
// - Name
// - Office (with color dot)
// - Source
// - Priority
// - Valid from/to
// - Actions (edit, blacklist)
```

---

### Page 7: `/system-templates` - Layout Partials with Versioning

**Purpose:** Manage headers, footers, signatures with version history.

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Breadcrumb: Dashboard > Systemmaler                             â”‚
â”‚                                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Tabs: [Topptekster] [Bunntekster] [Signaturer] [Stilark]    â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ Partial Grid:                               [+ Ny topptekst] â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚ â”‚ Standard PDF Header           v3          [â˜… Default]   â”‚  â”‚ â”‚
â”‚ â”‚ â”‚ Brukes i: pdf, email                                    â”‚  â”‚ â”‚
â”‚ â”‚ â”‚ Sist endret: 2 dager siden                             â”‚  â”‚ â”‚
â”‚ â”‚ â”‚                                    [Historikk] [Rediger]â”‚  â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â”‚                                                              â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚ â”‚ Kontraktsdokument Header      v1                        â”‚  â”‚ â”‚
â”‚ â”‚ â”‚ Brukes i: Kontraktsmaler                               â”‚  â”‚ â”‚
â”‚ â”‚ â”‚ Sist endret: 5 dager siden                             â”‚  â”‚ â”‚
â”‚ â”‚ â”‚                                    [Historikk] [Rediger]â”‚  â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Component: `VersionHistorySheet.tsx`

```typescript
interface VersionHistorySheetProps {
  partialId: string;
  partialName: string;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onRestore: (versionNumber: number) => void;
}

// Displays:
// - Timeline of versions
// - Change notes per version
// - Created by and date
// - Diff preview button
// - Restore button per version

// Layout:
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ Versjonshistorikk: Standard PDF Header      â”‚
// â”‚                                             â”‚
// â”‚ â— v3 (gjeldende)           2 dager siden   â”‚
// â”‚   "Oppdatert logo og farger"               â”‚
// â”‚   av system                                 â”‚
// â”‚                                             â”‚
// â”‚ â—‹ v2                       1 uke siden      â”‚
// â”‚   "Lagt til telefonnummer"     [Gjenopprett]â”‚
// â”‚   av system                                 â”‚
// â”‚                                             â”‚
// â”‚ â—‹ v1                       2 uker siden     â”‚
// â”‚   "FÃ¸rste versjon"             [Gjenopprett]â”‚
// â”‚   av system                                 â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ENHANCED EXISTING PAGES

### Template Viewer Enhancements

Add version history tab to the existing 4-tab template viewer.

#### New Tab: History

```typescript
// Add to TemplateDetailSheet.tsx TabsList:
<TabsTrigger value="history" className="gap-2">
  <History className="h-4 w-4" />
  Historikk
</TabsTrigger>

// TabContent:
<TabsContent value="history">
  <TemplateVersionHistory
    templateId={template.id}
    currentVersion={template.version}
    onRestore={handleRestoreVersion}
  />
</TabsContent>
```

#### Component: `TemplateVersionHistory.tsx`

```typescript
interface TemplateVersionHistoryProps {
  templateId: string;
  currentVersion: number;
  onRestore: (versionNumber: number) => Promise<void>;
}

// Features:
// - List of all versions with timestamps
// - Change notes display
// - Preview version content
// - Restore with confirmation dialog
// - Shows created_by
```

### Bulk Selection Mode

Add multi-select capability to template library.

#### Component: `BulkActionToolbar.tsx`

```typescript
interface BulkActionToolbarProps {
  selectedCount: number;
  selectedIds: string[];
  onStatusChange: (status: TemplateStatus) => Promise<void>;
  onCategoryChange: (categoryIds: string[], mode: 'add' | 'replace' | 'remove') => Promise<void>;
  onArchive: () => Promise<void>;
  onClear: () => void;
}

// Layout (appears when selection > 0):
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ 3 maler valgt    [Status â–¼] [Kategori â–¼] [Arkiver] [Avbryt]   â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ShelfLibrary Enhancement

```typescript
// Add to ShelfLibrary state:
const [selectionMode, setSelectionMode] = useState(false);
const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());

// Add toggle button in header:
<Button
  variant={selectionMode ? "default" : "outline"}
  size="sm"
  onClick={() => {
    setSelectionMode(!selectionMode);
    if (!selectionMode) setSelectedIds(new Set());
  }}
>
  <CheckSquare className="h-4 w-4 mr-1" />
  Velg flere
</Button>

// Pass to TemplateCard:
<TemplateCard
  ...
  selectionMode={selectionMode}
  selected={selectedIds.has(template.id)}
  onToggleSelect={() => toggleSelection(template.id)}
/>
```

---

## NEW TYPES

### File: `frontend/src/types/v3/index.ts`

```typescript
/**
 * V3 Types - Office & Employee Hub
 */

// Office
export interface Office {
  id: string;
  name: string;
  short_code: string;
  email: string;
  phone: string;
  street_address: string;
  postal_code: string;
  city: string;
  homepage_url: string | null;
  google_my_business_url: string | null;
  facebook_url: string | null;
  instagram_url: string | null;
  linkedin_url: string | null;
  color: string; // Hex color for territory map
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

export interface OfficeWithStats extends Office {
  employee_count: number;
  active_employees: number;
  territory_count: number;
}

export type OfficeCreatePayload = Omit<Office, 'id' | 'created_at' | 'updated_at'>;
export type OfficeUpdatePayload = Partial<OfficeCreatePayload>;

// Employee
export type EmployeeStatus = 'active' | 'onboarding' | 'offboarding' | 'inactive';

export interface Employee {
  id: string;
  office_id: string;
  first_name: string;
  last_name: string;
  title: string;
  email: string;
  phone: string;
  homepage_profile_url: string | null;
  linkedin_url: string | null;
  status: EmployeeStatus;
  start_date: string; // ISO date
  end_date: string | null;
  hide_from_homepage_date: string | null;
  delete_data_date: string | null;
  created_at: string;
  updated_at: string;
}

export interface EmployeeWithOffice extends Employee {
  office: Pick<Office, 'id' | 'name' | 'short_code' | 'color'>;
}

export type EmployeeCreatePayload = Omit<Employee, 'id' | 'created_at' | 'updated_at'>;
export type EmployeeUpdatePayload = Partial<EmployeeCreatePayload>;

// External Listings
export type ListingSource = 
  | 'anbudstjenester' 
  | 'finn' 
  | 'nummeropplysning' 
  | '1881' 
  | 'gulesider' 
  | 'google' 
  | 'other';

export type ListingStatus = 'verified' | 'needs_update' | 'pending_check' | 'removed';
export type ListingType = 'office' | 'broker' | 'company';

export interface ExternalListing {
  id: string;
  office_id: string | null;
  employee_id: string | null;
  source: ListingSource;
  listing_url: string;
  listing_type: ListingType;
  status: ListingStatus;
  last_verified_at: string | null;
  last_verified_by: string | null;
  notes: string | null;
  created_at: string;
  updated_at: string;
}

// Checklists
export type ChecklistType = 'onboarding' | 'offboarding';
export type ChecklistStatus = 'in_progress' | 'completed' | 'cancelled';

export interface ChecklistItem {
  name: string;
  description: string | null;
  required: boolean;
  order: number;
}

export interface ChecklistTemplate {
  id: string;
  name: string;
  description: string | null;
  type: ChecklistType;
  items: ChecklistItem[];
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

export interface ChecklistInstance {
  id: string;
  template_id: string;
  employee_id: string;
  status: ChecklistStatus;
  items_completed: string[]; // Item names that are completed
  due_date: string;
  completed_at: string | null;
  created_at: string;
  updated_at: string;
}

export interface ChecklistInstanceWithDetails extends ChecklistInstance {
  template: ChecklistTemplate;
  employee: Pick<Employee, 'id' | 'first_name' | 'last_name'>;
  progress: {
    completed: number;
    total: number;
    percentage: number;
  };
}

// Company Assets
export type AssetCategory = 'logo' | 'photo' | 'marketing' | 'document' | 'other';

export interface AssetMetadata {
  dimensions?: { width: number; height: number };
  alt_text?: string;
  usage_notes?: string;
}

export interface CompanyAsset {
  id: string;
  office_id: string | null;
  employee_id: string | null;
  is_global: boolean;
  name: string;
  filename: string;
  category: AssetCategory;
  content_type: string;
  file_size: number;
  metadata: AssetMetadata;
  created_at: string;
  updated_at: string;
}

export interface AssetUploadPayload {
  file: File;
  name: string;
  category: AssetCategory;
  office_id?: string;
  employee_id?: string;
  is_global?: boolean;
  metadata?: AssetMetadata;
}

// Territory
export type TerritorySource = 'vitec_next' | 'finn' | 'anbudstjenester' | 'homepage' | 'other';

export interface PostalCode {
  postal_code: string;
  postal_name: string;
  municipality_code: string;
  municipality_name: string;
  category: string;
}

export interface OfficeTerritory {
  id: string;
  office_id: string;
  postal_code: string;
  source: TerritorySource;
  priority: number;
  is_blacklisted: boolean;
  valid_from: string;
  valid_to: string | null;
  created_at: string;
  updated_at: string;
}

export interface OfficeTerritoryWithDetails extends OfficeTerritory {
  office: Pick<Office, 'id' | 'name' | 'short_code' | 'color'>;
  postal_info: PostalCode;
}

export interface TerritoryMapData {
  type: 'FeatureCollection';
  features: TerritoryFeature[];
}

export interface TerritoryFeature {
  type: 'Feature';
  properties: {
    postal_code: string;
    postal_name: string;
    office_id: string | null;
    office_name: string | null;
    office_color: string | null;
    source: TerritorySource | null;
    is_blacklisted: boolean;
  };
  geometry: GeoJSON.Polygon;
}

// Layout Partial Versioning
export interface LayoutPartialVersion {
  id: string;
  partial_id: string;
  version_number: number;
  html_content: string;
  change_notes: string | null;
  created_at: string;
  created_by: string;
}

export interface LayoutPartialDefault {
  id: string;
  partial_id: string;
  scope: 'all' | 'category' | 'medium';
  category_id: string | null;
  medium: 'pdf' | 'email' | 'sms' | null;
  priority: number;
  created_at: string;
  updated_at: string;
}

// Template Versioning (for bulk operations)
export interface TemplateVersion {
  id: string;
  template_id: string;
  version_number: number;
  file_name: string;
  file_size_bytes: number;
  created_by: string;
  change_notes: string | null;
  created_at: string;
}

export interface BulkStatusUpdate {
  template_ids: string[];
  status: 'draft' | 'published' | 'archived';
}

export interface BulkCategoryUpdate {
  template_ids: string[];
  category_ids: string[];
  mode: 'add' | 'replace' | 'remove';
}

export interface BulkOperationResult {
  updated: number;
  failed: number;
  updated_ids: string[];
  failed_details: Array<{ id: string; error: string }>;
}
```

---

## NEW API CLIENTS

### File: `frontend/src/lib/api/offices.ts`

```typescript
import { API_BASE_URL } from './config';
import type { 
  Office, 
  OfficeWithStats, 
  OfficeCreatePayload, 
  OfficeUpdatePayload 
} from '@/types/v3';

export interface OfficeListParams {
  city?: string;
  is_active?: boolean;
}

export const officesApi = {
  async list(params?: OfficeListParams): Promise<OfficeWithStats[]> {
    const searchParams = new URLSearchParams();
    if (params?.city) searchParams.set('city', params.city);
    if (params?.is_active !== undefined) {
      searchParams.set('is_active', String(params.is_active));
    }
    
    const url = `${API_BASE_URL}/api/offices?${searchParams}`;
    const response = await fetch(url, { credentials: 'include' });
    if (!response.ok) throw new Error('Failed to fetch offices');
    return response.json();
  },

  async get(id: string): Promise<OfficeWithStats> {
    const response = await fetch(`${API_BASE_URL}/api/offices/${id}`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch office');
    return response.json();
  },

  async create(data: OfficeCreatePayload): Promise<Office> {
    const response = await fetch(`${API_BASE_URL}/api/offices`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to create office');
    return response.json();
  },

  async update(id: string, data: OfficeUpdatePayload): Promise<Office> {
    const response = await fetch(`${API_BASE_URL}/api/offices/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to update office');
    return response.json();
  },

  async deactivate(id: string): Promise<void> {
    const response = await fetch(`${API_BASE_URL}/api/offices/${id}`, {
      method: 'DELETE',
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to deactivate office');
  },
};
```

### File: `frontend/src/lib/api/employees.ts`

```typescript
import { API_BASE_URL } from './config';
import type { 
  Employee, 
  EmployeeWithOffice, 
  EmployeeCreatePayload, 
  EmployeeUpdatePayload,
  EmployeeStatus 
} from '@/types/v3';

export interface EmployeeListParams {
  office_id?: string;
  status?: EmployeeStatus | EmployeeStatus[];
}

export const employeesApi = {
  async list(params?: EmployeeListParams): Promise<EmployeeWithOffice[]> {
    const searchParams = new URLSearchParams();
    if (params?.office_id) searchParams.set('office_id', params.office_id);
    if (params?.status) {
      const statuses = Array.isArray(params.status) ? params.status : [params.status];
      statuses.forEach(s => searchParams.append('status', s));
    }
    
    const url = `${API_BASE_URL}/api/employees?${searchParams}`;
    const response = await fetch(url, { credentials: 'include' });
    if (!response.ok) throw new Error('Failed to fetch employees');
    return response.json();
  },

  async get(id: string): Promise<EmployeeWithOffice> {
    const response = await fetch(`${API_BASE_URL}/api/employees/${id}`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch employee');
    return response.json();
  },

  async create(data: EmployeeCreatePayload): Promise<Employee> {
    const response = await fetch(`${API_BASE_URL}/api/employees`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to create employee');
    return response.json();
  },

  async update(id: string, data: EmployeeUpdatePayload): Promise<Employee> {
    const response = await fetch(`${API_BASE_URL}/api/employees/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to update employee');
    return response.json();
  },

  async startOffboarding(
    id: string, 
    data: { end_date: string; hide_from_homepage_date?: string; delete_data_date?: string }
  ): Promise<Employee> {
    const response = await fetch(`${API_BASE_URL}/api/employees/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({
        status: 'offboarding',
        ...data,
      }),
    });
    if (!response.ok) throw new Error('Failed to start offboarding');
    return response.json();
  },

  async deactivate(id: string): Promise<void> {
    const response = await fetch(`${API_BASE_URL}/api/employees/${id}`, {
      method: 'DELETE',
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to deactivate employee');
  },
};
```

### File: `frontend/src/lib/api/assets.ts`

```typescript
import { API_BASE_URL } from './config';
import type { 
  CompanyAsset, 
  AssetUploadPayload, 
  AssetCategory,
  AssetMetadata 
} from '@/types/v3';

export interface AssetListParams {
  category?: AssetCategory;
  office_id?: string;
  employee_id?: string;
  is_global?: boolean;
}

export const assetsApi = {
  async list(params?: AssetListParams): Promise<CompanyAsset[]> {
    const searchParams = new URLSearchParams();
    if (params?.category) searchParams.set('category', params.category);
    if (params?.office_id) searchParams.set('office_id', params.office_id);
    if (params?.employee_id) searchParams.set('employee_id', params.employee_id);
    if (params?.is_global !== undefined) {
      searchParams.set('is_global', String(params.is_global));
    }
    
    const url = `${API_BASE_URL}/api/assets?${searchParams}`;
    const response = await fetch(url, { credentials: 'include' });
    if (!response.ok) throw new Error('Failed to fetch assets');
    return response.json();
  },

  async get(id: string): Promise<CompanyAsset> {
    const response = await fetch(`${API_BASE_URL}/api/assets/${id}`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch asset');
    return response.json();
  },

  async upload(payload: AssetUploadPayload): Promise<CompanyAsset> {
    const formData = new FormData();
    formData.append('file', payload.file);
    formData.append('name', payload.name);
    formData.append('category', payload.category);
    if (payload.office_id) formData.append('office_id', payload.office_id);
    if (payload.employee_id) formData.append('employee_id', payload.employee_id);
    if (payload.is_global !== undefined) {
      formData.append('is_global', String(payload.is_global));
    }
    if (payload.metadata) {
      formData.append('metadata', JSON.stringify(payload.metadata));
    }

    const response = await fetch(`${API_BASE_URL}/api/assets/upload`, {
      method: 'POST',
      credentials: 'include',
      body: formData,
    });
    if (!response.ok) throw new Error('Failed to upload asset');
    return response.json();
  },

  async download(id: string): Promise<Blob> {
    const response = await fetch(`${API_BASE_URL}/api/assets/${id}/download`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to download asset');
    return response.blob();
  },

  async updateMetadata(id: string, metadata: AssetMetadata): Promise<CompanyAsset> {
    const response = await fetch(`${API_BASE_URL}/api/assets/${id}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ metadata }),
    });
    if (!response.ok) throw new Error('Failed to update asset');
    return response.json();
  },

  async delete(id: string): Promise<void> {
    const response = await fetch(`${API_BASE_URL}/api/assets/${id}`, {
      method: 'DELETE',
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to delete asset');
  },
};
```

### File: `frontend/src/lib/api/territories.ts`

```typescript
import { API_BASE_URL } from './config';
import type { 
  PostalCode,
  OfficeTerritory,
  OfficeTerritoryWithDetails,
  TerritoryMapData,
  TerritorySource 
} from '@/types/v3';

export interface TerritoryListParams {
  office_id?: string;
  source?: TerritorySource;
}

export const territoriesApi = {
  async listPostalCodes(): Promise<PostalCode[]> {
    const response = await fetch(`${API_BASE_URL}/api/postal-codes`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch postal codes');
    return response.json();
  },

  async syncPostalCodes(): Promise<{ synced: number; message: string }> {
    const response = await fetch(`${API_BASE_URL}/api/postal-codes/sync`, {
      method: 'POST',
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to sync postal codes');
    return response.json();
  },

  async list(params?: TerritoryListParams): Promise<OfficeTerritoryWithDetails[]> {
    const searchParams = new URLSearchParams();
    if (params?.office_id) searchParams.set('office_id', params.office_id);
    if (params?.source) searchParams.set('source', params.source);
    
    const url = `${API_BASE_URL}/api/territories?${searchParams}`;
    const response = await fetch(url, { credentials: 'include' });
    if (!response.ok) throw new Error('Failed to fetch territories');
    return response.json();
  },

  async getMapData(layers?: TerritorySource[]): Promise<TerritoryMapData> {
    const searchParams = new URLSearchParams();
    if (layers?.length) {
      layers.forEach(l => searchParams.append('layer', l));
    }
    
    const url = `${API_BASE_URL}/api/territories/map?${searchParams}`;
    const response = await fetch(url, { credentials: 'include' });
    if (!response.ok) throw new Error('Failed to fetch map data');
    return response.json();
  },

  async getLayers(): Promise<TerritorySource[]> {
    const response = await fetch(`${API_BASE_URL}/api/territories/layers`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch layers');
    return response.json();
  },

  async importFromCsv(file: File): Promise<{ imported: number; errors: string[] }> {
    const formData = new FormData();
    formData.append('file', file);
    
    const response = await fetch(`${API_BASE_URL}/api/territories/import`, {
      method: 'POST',
      credentials: 'include',
      body: formData,
    });
    if (!response.ok) throw new Error('Failed to import territories');
    return response.json();
  },

  async getBlacklist(): Promise<string[]> {
    const response = await fetch(`${API_BASE_URL}/api/territories/blacklist`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch blacklist');
    return response.json();
  },

  async addToBlacklist(postalCode: string): Promise<void> {
    const response = await fetch(`${API_BASE_URL}/api/territories/blacklist`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ postal_code: postalCode }),
    });
    if (!response.ok) throw new Error('Failed to add to blacklist');
  },
};
```

### File: `frontend/src/lib/api/checklists.ts`

```typescript
import { API_BASE_URL } from './config';
import type { 
  ChecklistTemplate,
  ChecklistInstance,
  ChecklistInstanceWithDetails,
  ChecklistItem,
  ChecklistType,
  ChecklistStatus 
} from '@/types/v3';

export const checklistsApi = {
  // Templates
  async listTemplates(): Promise<ChecklistTemplate[]> {
    const response = await fetch(`${API_BASE_URL}/api/checklists/templates`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch checklist templates');
    return response.json();
  },

  async createTemplate(data: {
    name: string;
    description?: string;
    type: ChecklistType;
    items: ChecklistItem[];
  }): Promise<ChecklistTemplate> {
    const response = await fetch(`${API_BASE_URL}/api/checklists/templates`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to create checklist template');
    return response.json();
  },

  // Instances
  async listInstances(params?: {
    employee_id?: string;
    status?: ChecklistStatus;
  }): Promise<ChecklistInstanceWithDetails[]> {
    const searchParams = new URLSearchParams();
    if (params?.employee_id) searchParams.set('employee_id', params.employee_id);
    if (params?.status) searchParams.set('status', params.status);
    
    const url = `${API_BASE_URL}/api/checklists/instances?${searchParams}`;
    const response = await fetch(url, { credentials: 'include' });
    if (!response.ok) throw new Error('Failed to fetch checklist instances');
    return response.json();
  },

  async assignToEmployee(data: {
    template_id: string;
    employee_id: string;
    due_date: string;
  }): Promise<ChecklistInstance> {
    const response = await fetch(`${API_BASE_URL}/api/checklists/instances`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to assign checklist');
    return response.json();
  },

  async updateProgress(
    instanceId: string, 
    itemsCompleted: string[]
  ): Promise<ChecklistInstance> {
    const response = await fetch(`${API_BASE_URL}/api/checklists/instances/${instanceId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ items_completed: itemsCompleted }),
    });
    if (!response.ok) throw new Error('Failed to update checklist progress');
    return response.json();
  },
};
```

### File: `frontend/src/lib/api/template-versions.ts`

```typescript
import { API_BASE_URL } from './config';
import type { 
  TemplateVersion,
  BulkStatusUpdate,
  BulkCategoryUpdate,
  BulkOperationResult 
} from '@/types/v3';

export const templateVersionsApi = {
  async listVersions(templateId: string): Promise<{
    template_id: string;
    current_version: number;
    versions: TemplateVersion[];
  }> {
    const response = await fetch(`${API_BASE_URL}/api/templates/${templateId}/versions`, {
      credentials: 'include',
    });
    if (!response.ok) throw new Error('Failed to fetch versions');
    return response.json();
  },

  async getVersionContent(templateId: string, versionNumber: number): Promise<{
    version_number: number;
    file_name: string;
    change_notes: string | null;
    content_available: boolean;
  }> {
    const response = await fetch(
      `${API_BASE_URL}/api/templates/${templateId}/versions/${versionNumber}/content`,
      { credentials: 'include' }
    );
    if (!response.ok) throw new Error('Failed to fetch version content');
    return response.json();
  },

  async restoreVersion(templateId: string, versionNumber: number): Promise<{
    template_id: string;
    restored_from: number;
    new_version: number;
    message: string;
  }> {
    const response = await fetch(
      `${API_BASE_URL}/api/templates/${templateId}/versions/${versionNumber}/restore`,
      {
        method: 'POST',
        credentials: 'include',
      }
    );
    if (!response.ok) throw new Error('Failed to restore version');
    return response.json();
  },

  // Bulk operations
  async bulkUpdateStatus(data: BulkStatusUpdate): Promise<BulkOperationResult> {
    const response = await fetch(`${API_BASE_URL}/api/templates/bulk/status`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to update status');
    return response.json();
  },

  async bulkUpdateCategories(data: BulkCategoryUpdate): Promise<BulkOperationResult> {
    const response = await fetch(`${API_BASE_URL}/api/templates/bulk/categories`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error('Failed to update categories');
    return response.json();
  },

  async bulkArchive(templateIds: string[]): Promise<BulkOperationResult> {
    const response = await fetch(`${API_BASE_URL}/api/templates/bulk`, {
      method: 'DELETE',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ template_ids: templateIds }),
    });
    if (!response.ok) throw new Error('Failed to archive templates');
    return response.json();
  },
};
```

---

## NEW HOOKS

### File: `frontend/src/hooks/v3/useOffices.ts`

```typescript
import { useState, useEffect, useCallback } from 'react';
import { officesApi, type OfficeListParams } from '@/lib/api/offices';
import type { Office, OfficeWithStats } from '@/types/v3';

export function useOffices(params?: OfficeListParams) {
  const [offices, setOffices] = useState<OfficeWithStats[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetch = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    try {
      const data = await officesApi.list(params);
      setOffices(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch offices');
    } finally {
      setIsLoading(false);
    }
  }, [params?.city, params?.is_active]);

  useEffect(() => {
    fetch();
  }, [fetch]);

  return { offices, isLoading, error, refetch: fetch };
}

export function useOffice(id: string | null) {
  const [office, setOffice] = useState<OfficeWithStats | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (!id) {
      setOffice(null);
      return;
    }

    const fetch = async () => {
      setIsLoading(true);
      setError(null);
      try {
        const data = await officesApi.get(id);
        setOffice(data);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Failed to fetch office');
      } finally {
        setIsLoading(false);
      }
    };

    fetch();
  }, [id]);

  return { office, isLoading, error };
}
```

### File: `frontend/src/hooks/v3/useEmployees.ts`

```typescript
import { useState, useEffect, useCallback } from 'react';
import { employeesApi, type EmployeeListParams } from '@/lib/api/employees';
import type { Employee, EmployeeWithOffice, EmployeeStatus } from '@/types/v3';

export function useEmployees(params?: EmployeeListParams) {
  const [employees, setEmployees] = useState<EmployeeWithOffice[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetch = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    try {
      const data = await employeesApi.list(params);
      setEmployees(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch employees');
    } finally {
      setIsLoading(false);
    }
  }, [params?.office_id, JSON.stringify(params?.status)]);

  useEffect(() => {
    fetch();
  }, [fetch]);

  // Group by status
  const byStatus = employees.reduce((acc, emp) => {
    const status = emp.status;
    if (!acc[status]) acc[status] = [];
    acc[status].push(emp);
    return acc;
  }, {} as Record<EmployeeStatus, EmployeeWithOffice[]>);

  return { 
    employees, 
    byStatus,
    isLoading, 
    error, 
    refetch: fetch 
  };
}

export function useEmployee(id: string | null) {
  const [employee, setEmployee] = useState<EmployeeWithOffice | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (!id) {
      setEmployee(null);
      return;
    }

    const fetch = async () => {
      setIsLoading(true);
      setError(null);
      try {
        const data = await employeesApi.get(id);
        setEmployee(data);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Failed to fetch employee');
      } finally {
        setIsLoading(false);
      }
    };

    fetch();
  }, [id]);

  return { employee, isLoading, error };
}
```

### File: `frontend/src/hooks/v3/useAssets.ts`

```typescript
import { useState, useEffect, useCallback } from 'react';
import { assetsApi, type AssetListParams } from '@/lib/api/assets';
import type { CompanyAsset, AssetCategory } from '@/types/v3';

export function useAssets(params?: AssetListParams) {
  const [assets, setAssets] = useState<CompanyAsset[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetch = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    try {
      const data = await assetsApi.list(params);
      setAssets(data);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch assets');
    } finally {
      setIsLoading(false);
    }
  }, [params?.category, params?.office_id, params?.employee_id, params?.is_global]);

  useEffect(() => {
    fetch();
  }, [fetch]);

  // Group by category
  const byCategory = assets.reduce((acc, asset) => {
    const cat = asset.category;
    if (!acc[cat]) acc[cat] = [];
    acc[cat].push(asset);
    return acc;
  }, {} as Record<AssetCategory, CompanyAsset[]>);

  return { 
    assets, 
    byCategory,
    isLoading, 
    error, 
    refetch: fetch 
  };
}
```

### File: `frontend/src/hooks/v3/useTerritoryMap.ts`

```typescript
import { useState, useEffect, useCallback } from 'react';
import { territoriesApi } from '@/lib/api/territories';
import type { TerritoryMapData, TerritorySource, OfficeTerritoryWithDetails } from '@/types/v3';

export function useTerritoryMap(activeLayers: TerritorySource[] = ['vitec_next']) {
  const [mapData, setMapData] = useState<TerritoryMapData | null>(null);
  const [territories, setTerritories] = useState<OfficeTerritoryWithDetails[]>([]);
  const [blacklist, setBlacklist] = useState<string[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetch = useCallback(async () => {
    setIsLoading(true);
    setError(null);
    try {
      const [map, terrs, bl] = await Promise.all([
        territoriesApi.getMapData(activeLayers),
        territoriesApi.list(),
        territoriesApi.getBlacklist(),
      ]);
      setMapData(map);
      setTerritories(terrs);
      setBlacklist(bl);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch territory data');
    } finally {
      setIsLoading(false);
    }
  }, [JSON.stringify(activeLayers)]);

  useEffect(() => {
    fetch();
  }, [fetch]);

  return { 
    mapData, 
    territories, 
    blacklist,
    isLoading, 
    error, 
    refetch: fetch 
  };
}
```

### File: `frontend/src/hooks/v3/useTemplateVersions.ts`

```typescript
import { useState, useEffect, useCallback } from 'react';
import { templateVersionsApi } from '@/lib/api/template-versions';
import type { TemplateVersion } from '@/types/v3';

export function useTemplateVersions(templateId: string | null) {
  const [versions, setVersions] = useState<TemplateVersion[]>([]);
  const [currentVersion, setCurrentVersion] = useState<number>(1);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const fetch = useCallback(async () => {
    if (!templateId) return;
    
    setIsLoading(true);
    setError(null);
    try {
      const data = await templateVersionsApi.listVersions(templateId);
      setVersions(data.versions);
      setCurrentVersion(data.current_version);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Failed to fetch versions');
    } finally {
      setIsLoading(false);
    }
  }, [templateId]);

  useEffect(() => {
    fetch();
  }, [fetch]);

  const restore = useCallback(async (versionNumber: number) => {
    if (!templateId) return;
    
    const result = await templateVersionsApi.restoreVersion(templateId, versionNumber);
    await fetch(); // Refresh versions
    return result;
  }, [templateId, fetch]);

  return { 
    versions, 
    currentVersion,
    isLoading, 
    error, 
    refetch: fetch,
    restore,
  };
}
```

### File: `frontend/src/hooks/v3/useBulkSelection.ts`

```typescript
import { useState, useCallback } from 'react';
import { templateVersionsApi } from '@/lib/api/template-versions';
import type { BulkOperationResult, TemplateStatus } from '@/types/v3';

export function useBulkSelection() {
  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
  const [isProcessing, setIsProcessing] = useState(false);

  const toggle = useCallback((id: string) => {
    setSelectedIds(prev => {
      const next = new Set(prev);
      if (next.has(id)) {
        next.delete(id);
      } else {
        next.add(id);
      }
      return next;
    });
  }, []);

  const selectAll = useCallback((ids: string[]) => {
    setSelectedIds(new Set(ids));
  }, []);

  const clear = useCallback(() => {
    setSelectedIds(new Set());
  }, []);

  const updateStatus = useCallback(async (status: TemplateStatus): Promise<BulkOperationResult> => {
    if (selectedIds.size === 0) throw new Error('No templates selected');
    
    setIsProcessing(true);
    try {
      const result = await templateVersionsApi.bulkUpdateStatus({
        template_ids: Array.from(selectedIds),
        status,
      });
      clear();
      return result;
    } finally {
      setIsProcessing(false);
    }
  }, [selectedIds, clear]);

  const updateCategories = useCallback(async (
    categoryIds: string[], 
    mode: 'add' | 'replace' | 'remove'
  ): Promise<BulkOperationResult> => {
    if (selectedIds.size === 0) throw new Error('No templates selected');
    
    setIsProcessing(true);
    try {
      const result = await templateVersionsApi.bulkUpdateCategories({
        template_ids: Array.from(selectedIds),
        category_ids: categoryIds,
        mode,
      });
      clear();
      return result;
    } finally {
      setIsProcessing(false);
    }
  }, [selectedIds, clear]);

  const archive = useCallback(async (): Promise<BulkOperationResult> => {
    if (selectedIds.size === 0) throw new Error('No templates selected');
    
    setIsProcessing(true);
    try {
      const result = await templateVersionsApi.bulkArchive(Array.from(selectedIds));
      clear();
      return result;
    } finally {
      setIsProcessing(false);
    }
  }, [selectedIds, clear]);

  return {
    selectedIds,
    selectedCount: selectedIds.size,
    isProcessing,
    toggle,
    selectAll,
    clear,
    isSelected: (id: string) => selectedIds.has(id),
    updateStatus,
    updateCategories,
    archive,
  };
}
```

---

## NEW COMPONENTS FILE STRUCTURE

```
frontend/src/components/
â”œâ”€â”€ offices/
â”‚   â”œâ”€â”€ OfficeCard.tsx
â”‚   â”œâ”€â”€ OfficeGrid.tsx
â”‚   â”œâ”€â”€ OfficeHeader.tsx
â”‚   â”œâ”€â”€ OfficeForm.tsx (dialog for create/edit)
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ employees/
â”‚   â”œâ”€â”€ EmployeeCard.tsx
â”‚   â”œâ”€â”€ EmployeeGrid.tsx
â”‚   â”œâ”€â”€ EmployeeHeader.tsx
â”‚   â”œâ”€â”€ EmployeeSidebar.tsx
â”‚   â”œâ”€â”€ EmployeeForm.tsx
â”‚   â”œâ”€â”€ OffboardingPanel.tsx
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ AssetGallery.tsx
â”‚   â”œâ”€â”€ AssetCard.tsx
â”‚   â”œâ”€â”€ AssetUploadDialog.tsx
â”‚   â”œâ”€â”€ AssetDetailSheet.tsx
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ territories/
â”‚   â”œâ”€â”€ TerritoryMap.tsx
â”‚   â”œâ”€â”€ TerritoryMiniMap.tsx (for office detail)
â”‚   â”œâ”€â”€ LayerControls.tsx
â”‚   â”œâ”€â”€ PostalCodeTable.tsx
â”‚   â”œâ”€â”€ ImportTerritoryDialog.tsx
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ checklists/
â”‚   â”œâ”€â”€ ChecklistProgress.tsx
â”‚   â”œâ”€â”€ ChecklistItemRow.tsx
â”‚   â”œâ”€â”€ ChecklistAssignDialog.tsx
â”‚   â”œâ”€â”€ ChecklistTemplateEditor.tsx
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ external-listings/
â”‚   â”œâ”€â”€ ExternalListingTable.tsx
â”‚   â”œâ”€â”€ ExternalListingForm.tsx
â”‚   â”œâ”€â”€ VerificationBadge.tsx
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ system-templates/
â”‚   â”œâ”€â”€ PartialCard.tsx
â”‚   â”œâ”€â”€ PartialGrid.tsx
â”‚   â”œâ”€â”€ VersionHistorySheet.tsx
â”‚   â”œâ”€â”€ DefaultRulesPanel.tsx
â”‚   â””â”€â”€ index.ts
â””â”€â”€ bulk/
    â”œâ”€â”€ BulkActionToolbar.tsx
    â”œâ”€â”€ BulkStatusDialog.tsx
    â”œâ”€â”€ BulkCategoryDialog.tsx
    â””â”€â”€ index.ts
```

---

## NAVIGATION UPDATES

### File: `frontend/src/components/layout/Header.tsx`

Add new navigation items:

```typescript
const navigationItems = [
  { href: '/', label: 'Dashboard', icon: LayoutDashboard },
  { href: '/templates', label: 'Maler', icon: FileText },
  { href: '/flettekoder', label: 'Flettekoder', icon: Code },
  { href: '/storage', label: 'Filer', icon: FolderOpen },
  // V3 additions:
  { href: '/offices', label: 'Kontorer', icon: Building2 },
  { href: '/employees', label: 'Ansatte', icon: Users },
  { href: '/assets', label: 'Mediefiler', icon: Image },
  { href: '/territories', label: 'MarkedsomrÃ¥de', icon: Map },
  { href: '/system-templates', label: 'Systemmaler', icon: Layout },
];
```

---

## DEPENDENCIES TO ADD

```json
{
  "dependencies": {
    "react-leaflet": "^4.2.1",
    "leaflet": "^1.9.4",
    "react-dropzone": "^14.2.3"
  },
  "devDependencies": {
    "@types/leaflet": "^1.9.8"
  }
}
```

---

## IMPLEMENTATION ORDER

1. **Types & API Clients** (Day 1)
   - Create `types/v3/index.ts`
   - Create all API clients in `lib/api/`
   - Update barrel exports

2. **Hooks** (Day 1)
   - Create all hooks in `hooks/v3/`
   - Test with mock data if backend not ready

3. **Office & Employee Components** (Day 2-3)
   - OfficeCard, OfficeGrid, OfficeForm
   - EmployeeCard, EmployeeGrid, EmployeeSidebar
   - OffboardingPanel

4. **Office & Employee Pages** (Day 3)
   - `/offices` and `/offices/[id]`
   - `/employees` and `/employees/[id]`

5. **Asset Components & Page** (Day 4)
   - AssetGallery, AssetCard, AssetUploadDialog
   - `/assets` page

6. **Territory Map** (Day 5)
   - TerritoryMap with Leaflet
   - LayerControls, PostalCodeTable
   - `/territories` page

7. **Checklists & External Listings** (Day 6)
   - ChecklistProgress, ChecklistAssignDialog
   - ExternalListingTable
   - Integrate into employee detail

8. **System Templates Versioning** (Day 7)
   - VersionHistorySheet
   - DefaultRulesPanel
   - `/system-templates` page

9. **Bulk Operations** (Day 8)
   - BulkActionToolbar
   - Integrate into ShelfLibrary
   - BulkStatusDialog, BulkCategoryDialog

10. **Template Version History Tab** (Day 8)
    - TemplateVersionHistory component
    - Add to TemplateDetailSheet

11. **Navigation & Polish** (Day 9)
    - Update Header navigation
    - Cross-page links
    - Loading states and error handling

---

## SUCCESS CRITERIA

| Feature | Criteria |
|---------|----------|
| Offices Page | Grid displays, CRUD works, employee count accurate |
| Office Detail | Tabs work, assets display, territory mini-map renders |
| Employees Page | Sidebar filtering works, status badges correct |
| Employee Detail | Offboarding panel shows, checklists track progress |
| Assets Page | Upload works, thumbnails display, scoping works |
| Territory Map | Map renders, layer toggles work, colors match offices |
| System Templates | Version history shows, restore works, defaults apply |
| Bulk Operations | Selection mode toggles, bulk actions complete |
| Version History Tab | Versions list, restore with confirmation |

---

## HANDOFF TO BUILDER

The Builder should:
1. Start with types and API clients (no backend dependency for structure)
2. Create hooks with proper loading/error states
3. Build components following existing Shadcn patterns
4. Create pages with proper suspense boundaries
5. Add navigation after pages are functional
6. Test with real backend as features complete

**Priority order based on dependencies:**
1. Categories seeding (backend-only, unblocks nothing)
2. Offices â†’ Employees â†’ Assets (chain dependency)
3. Checklists + External Listings (requires employees)
4. Territory Map (requires offices)
5. System Templates + Versioning (independent)
6. Bulk Operations (enhances existing)

---

**Next Step:** Invoke **BUILDER** agent with both specs to begin implementation.
