# Plan 05-01: Update Backend CORS

**Phase:** 5 - Vercel Migration
**Focus:** Configure CORS to accept Vercel domains
**Estimated:** 15 minutes

---

## Objective

Update the FastAPI backend to accept requests from Vercel domains (both production and preview deployments).

---

## Tasks

### 1. Update config.py

Add Vercel domains to allowed origins:

```python
# backend/app/config.py

# Find ALLOWED_ORIGINS and update to include Vercel
ALLOWED_ORIGINS: list[str] = Field(
    default=[
        "http://localhost:3000",
        "https://blissful-quietude-production.up.railway.app",
        "https://proaktiv-dokument-hub.vercel.app",
    ]
)
```

### 2. Update main.py CORS middleware

Ensure CORS middleware handles Vercel preview URLs:

```python
# backend/app/main.py

# Update the CORSMiddleware configuration
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.ALLOWED_ORIGINS,
    allow_origin_regex=r"https://.*\.vercel\.app",  # All Vercel preview URLs
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 3. Update Railway environment

Set the `ALLOWED_ORIGINS` environment variable in Railway:

```bash
railway variables set ALLOWED_ORIGINS='["https://proaktiv-dokument-hub.vercel.app","https://blissful-quietude-production.up.railway.app","http://localhost:3000"]'
```

---

## Verification

```bash
# Test CORS preflight from local
curl -X OPTIONS https://proaktiv-dokument-hub-production.up.railway.app/api/health \
  -H "Origin: https://proaktiv-dokument-hub.vercel.app" \
  -H "Access-Control-Request-Method: GET" \
  -v
```

Should return `Access-Control-Allow-Origin` header.

---

## Files Changed

- `backend/app/config.py`
- `backend/app/main.py`

---

## Commit Message

```
feat(cors): add Vercel domains to allowed origins

- Add proaktiv-dokument-hub.vercel.app to ALLOWED_ORIGINS
- Add regex pattern for Vercel preview deployments
- Prepare backend for Vercel frontend migration
```

---

## Next Plan

After committing, proceed to `05-02-PLAN.md` (Vercel Configuration).
