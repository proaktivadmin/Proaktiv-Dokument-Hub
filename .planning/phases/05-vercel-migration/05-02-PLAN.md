# Plan 05-02: Configure Vercel

**Phase:** 5 - Vercel Migration
**Focus:** Create vercel.json and update next.config.js
**Estimated:** 20 minutes

---

## Objective

Configure the frontend for Vercel deployment with proper API rewrites.

---

## Tasks

### 1. Create vercel.json

```json
// frontend/vercel.json
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://proaktiv-dokument-hub-production.up.railway.app/api/:path*"
    }
  ],
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        },
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-XSS-Protection",
          "value": "1; mode=block"
        }
      ]
    }
  ]
}
```

### 2. Update next.config.js

Remove Railway-specific rewrites (Vercel handles these via vercel.json):

```javascript
// frontend/next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "proaktiv.no",
      },
      {
        protocol: "https",
        hostname: "*.proaktiv.no",
      },
    ],
  },
  // Only use rewrites in non-Vercel environments
  ...(process.env.VERCEL
    ? {}
    : {
        async rewrites() {
          return [
            {
              source: "/api/:path*",
              destination: `${process.env.BACKEND_URL || "http://localhost:8000"}/api/:path*`,
            },
          ];
        },
      }),
};

module.exports = nextConfig;
```

### 3. Add .vercelignore (optional)

```
# frontend/.vercelignore
node_modules
.next
.git
*.md
!README.md
```

---

## Verification

- Run `npm run build` locally to verify config is valid
- Check that vercel.json passes schema validation

---

## Files Changed

- `frontend/vercel.json` (new)
- `frontend/next.config.js` (updated)
- `frontend/.vercelignore` (optional)

---

## Commit Message

```
feat(vercel): add Vercel configuration

- Create vercel.json with API rewrites
- Update next.config.js for Vercel compatibility
- Add security headers
```

---

## Next Plan

After committing, proceed to `05-03-PLAN.md` (Deploy to Vercel).
