---
phase: 06-entra-signature-sync
plan: 10
type: execute
wave: 3
depends_on: [06-09]
files_modified:
  - frontend/src/components/offices/OfficeGrid.tsx
  - frontend/src/components/offices/OfficeForm.tsx
  - frontend/src/lib/api/offices.ts
autonomous: true
---

<objective>
Add region filter and region field to office UI.
</objective>

<tasks>
<task type="auto">
  <name>Task 1: Update API Client</name>
  <files>frontend/src/lib/api/offices.ts</files>
  <action>
    Add region parameter to list function:
    ```typescript
    list: async (params?: { 
      region?: string; 
      city?: string;
      is_active?: boolean;
    }) => { ... }
    ```
    
    Add getRegions function:
    ```typescript
    getRegions: async () => api.get<{ regions: string[] }>('/offices/regions')
    ```
  </action>
</task>

<task type="auto">
  <name>Task 2: Add Region Filter to OfficeGrid</name>
  <files>frontend/src/components/offices/OfficeGrid.tsx</files>
  <action>
    Add region filter dropdown next to city filter:
    ```tsx
    <Select value={regionFilter} onValueChange={setRegionFilter}>
      <SelectTrigger className="w-[150px]">
        <SelectValue placeholder="Alle regioner" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="all">Alle regioner</SelectItem>
        {REGIONS.map((region) => (
          <SelectItem key={region} value={region}>
            {region}
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
    ```
    
    Update filtering logic to include region.
  </action>
</task>

<task type="auto">
  <name>Task 3: Add Region Grouping Option</name>
  <files>frontend/src/components/offices/OfficeGrid.tsx</files>
  <action>
    Add "Grupper etter region" toggle:
    - When enabled, offices are grouped by region
    - Each region shows as a section header
    - Offices without region shown in "Ukjent region" group
    
    ```tsx
    const [groupByRegion, setGroupByRegion] = useState(false);
    
    // Group offices by region
    const groupedOffices = groupByRegion 
      ? groupBy(filteredOffices, o => o.region || 'Ukjent')
      : null;
    ```
  </action>
</task>

<task type="auto">
  <name>Task 4: Add Region Badge to OfficeCard</name>
  <files>frontend/src/components/offices/OfficeCard.tsx</files>
  <action>
    Show region badge on office card (if region set):
    ```tsx
    {office.region && (
      <Badge variant="outline" className="text-xs">
        {office.region}
      </Badge>
    )}
    ```
  </action>
</task>

<task type="auto">
  <name>Task 5: Add Region to OfficeForm</name>
  <files>frontend/src/components/offices/OfficeForm.tsx</files>
  <action>
    Add region select field in Basic tab:
    ```tsx
    <FormField
      control={form.control}
      name="region"
      render={({ field }) => (
        <FormItem>
          <FormLabel>Region</FormLabel>
          <Select onValueChange={field.onChange} value={field.value || ""}>
            <SelectTrigger>
              <SelectValue placeholder="Velg region" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="">Ingen region</SelectItem>
              {REGIONS.map((region) => (
                <SelectItem key={region} value={region}>
                  {region}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
          <FormMessage />
        </FormItem>
      )}
    />
    ```
  </action>
</task>
</tasks>

<success_criteria>
- Region filter dropdown works
- Group by region toggle works
- Region badge shows on cards
- Region field in office form
- Filtering updates grid correctly
</success_criteria>
