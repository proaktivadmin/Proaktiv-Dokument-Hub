---
phase: 06-entra-signature-sync
plan: 06
type: execute
wave: 3
depends_on: [06-05]
files_modified:
  - frontend/src/lib/api/entra-sync.ts
  - frontend/src/types/entra-sync.ts
  - frontend/src/hooks/useEntraSync.ts
autonomous: true
---

<objective>
Create frontend API client, types, and hooks for Entra ID sync operations.
</objective>

<tasks>
<task type="auto">
  <name>Task 1: Create TypeScript Types</name>
  <files>frontend/src/types/entra-sync.ts</files>
  <action>
    Create TypeScript interfaces:
    ```typescript
    interface EntraSyncPreview {
      employee_id: string;
      employee_name: string;
      entra_user_found: boolean;
      entra_user_id?: string;
      profile_changes: PropertyChange[];
      photo_needs_update: boolean;
      signature_preview_available: boolean;
    }
    
    interface PropertyChange {
      property: string;
      current_value: string | null;
      new_value: string | null;
      will_update: boolean;
    }
    
    interface EntraSyncResult {
      success: boolean;
      employee_id: string;
      profile_updated: boolean;
      photo_updated: boolean;
      signature_pushed: boolean;
      error?: string;
    }
    
    interface SignaturePreview {
      html: string;
      text: string;
    }
    
    interface EntraSyncStatus {
      connected: boolean;
      tenant_id?: string;
      roaming_signatures_enabled: boolean;
    }
    ```
  </action>
</task>

<task type="auto">
  <name>Task 2: Create API Client</name>
  <files>frontend/src/lib/api/entra-sync.ts</files>
  <action>
    Create API client:
    ```typescript
    export const entraSyncApi = {
      getPreview: (employeeId: string) => 
        api.get<EntraSyncPreview>(`/entra-sync/preview/${employeeId}`),
      
      getSignaturePreview: (employeeId: string) =>
        api.get<SignaturePreview>(`/entra-sync/signature-preview/${employeeId}`),
      
      pushEmployee: (employeeId: string, scope: SyncScope[]) =>
        api.post<EntraSyncResult>(`/entra-sync/push/${employeeId}`, { scope }),
      
      pushBatch: (employeeIds: string[], scope: SyncScope[]) =>
        api.post<EntraSyncBatchResult>('/entra-sync/push-batch', { employee_ids: employeeIds, scope }),
      
      getStatus: () =>
        api.get<EntraSyncStatus>('/entra-sync/status'),
    };
    ```
  </action>
</task>

<task type="auto">
  <name>Task 3: Create React Hook</name>
  <files>frontend/src/hooks/useEntraSync.ts</files>
  <action>
    Create custom hook:
    ```typescript
    export function useEntraSync() {
      // Status query
      const statusQuery = useQuery(['entra-sync-status'], entraSyncApi.getStatus);
      
      // Preview mutation
      const previewMutation = useMutation(entraSyncApi.getPreview);
      
      // Push mutations
      const pushMutation = useMutation(entraSyncApi.pushEmployee);
      const pushBatchMutation = useMutation(entraSyncApi.pushBatch);
      
      return {
        isConnected: statusQuery.data?.connected ?? false,
        roamingSignaturesEnabled: statusQuery.data?.roaming_signatures_enabled ?? false,
        getPreview: previewMutation.mutateAsync,
        pushEmployee: pushMutation.mutateAsync,
        pushBatch: pushBatchMutation.mutateAsync,
        isLoading: pushMutation.isLoading || pushBatchMutation.isLoading,
      };
    }
    ```
  </action>
</task>

<task type="auto">
  <name>Task 4: Export from Index</name>
  <files>frontend/src/lib/api/index.ts, frontend/src/types/index.ts</files>
  <action>
    Export new modules from index files.
  </action>
</task>
</tasks>

<success_criteria>
- Types compile without errors
- API client works with backend endpoints
- Hook provides clean interface for components
- Loading and error states handled
</success_criteria>
