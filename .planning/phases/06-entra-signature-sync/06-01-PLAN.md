---
phase: 06-entra-signature-sync
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/entra-signature-sync.md
autonomous: true
---

<objective>
Create Azure App Registration setup documentation and prerequisites guide.
</objective>

<tasks>
<task type="manual">
  <name>Task 1: Create Azure App Registration</name>
  <files>-</files>
  <action>
    In Azure Portal (portal.azure.com):
    1. Navigate to Microsoft Entra ID → App registrations
    2. Click "New registration"
    3. Name: "Proaktiv Entra Sync"
    4. Supported account types: "Accounts in this organizational directory only"
    5. Click "Register"
    6. Note the Application (client) ID and Directory (tenant) ID
  </action>
</task>

<task type="manual">
  <name>Task 2: Configure API Permissions</name>
  <files>-</files>
  <action>
    In the app registration:
    1. Go to "API permissions"
    2. Click "Add a permission" → Microsoft Graph → Application permissions
    3. Add: User.Read.All, User.ReadWrite.All
    4. Click "Add a permission" → APIs my organization uses → Office 365 Exchange Online
    5. Add: Exchange.ManageAsApp
    6. Click "Grant admin consent for [tenant]"
  </action>
</task>

<task type="manual">
  <name>Task 3: Create Certificate or Client Secret</name>
  <files>-</files>
  <action>
    Option A - Certificate (recommended):
    1. Generate certificate: New-SelfSignedCertificate -Subject "CN=Proaktiv Entra Sync" -CertStoreLocation "Cert:\CurrentUser\My" -KeyExportPolicy Exportable -KeySpec Signature -KeyLength 2048 -KeyAlgorithm RSA -HashAlgorithm SHA256 -NotAfter (Get-Date).AddYears(2)
    2. Export public key (.cer) and upload to app registration → Certificates & secrets
    3. Note the certificate thumbprint

    Option B - Client Secret:
    1. Go to "Certificates & secrets" → Client secrets
    2. Click "New client secret"
    3. Description: "Proaktiv Entra Sync"
    4. Expiry: 24 months
    5. Copy and securely store the secret value
  </action>
</task>

<task type="manual">
  <name>Task 4: Assign Exchange Role to Service Principal</name>
  <files>-</files>
  <action>
    In PowerShell (as Exchange admin):
    ```powershell
    Connect-ExchangeOnline
    
    # Get the service principal app ID from step 1
    $appId = "your-app-id-here"
    
    # Create service principal if not exists
    New-ServicePrincipal -AppId $appId -ObjectId (Get-MgServicePrincipal -Filter "appId eq '$appId'").Id
    
    # Assign Exchange Recipient Administrator role
    New-ManagementRoleAssignment -Role "Exchange Recipient Administrator" -App $appId
    ```
  </action>
</task>

<task type="auto">
  <name>Task 5: Create Setup Documentation</name>
  <files>docs/entra-signature-sync.md</files>
  <action>
    Create comprehensive documentation with:
    - Prerequisites checklist
    - Step-by-step Azure setup guide
    - Environment variable configuration
    - Usage examples
    - Troubleshooting guide
  </action>
</task>
</tasks>

<success_criteria>
- Azure App Registration created with correct permissions
- Admin consent granted
- Certificate or client secret configured
- Exchange role assigned to service principal
- Setup documentation complete
</success_criteria>
