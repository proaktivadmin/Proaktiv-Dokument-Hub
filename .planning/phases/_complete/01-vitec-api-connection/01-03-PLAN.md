---
phase: 01-vitec-api-connection
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Backend successfully authenticates with Vitec Next API in production"
    - "Admin can trigger employee sync and see Vitec employee data fetched"
    - "Admin can trigger office sync and see Vitec office data fetched"
    - "API errors surface clearly in UI (not silent failures)"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Vitec API integration works in production with real credentials and data.

Purpose: Plans 01 and 02 added the verification infrastructure. This plan confirms the full flow works end-to-end in the production environment with real Vitec API credentials.

Output: Verified working sync in production, documented any issues found.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/01-vitec-api-connection/01-01-SUMMARY.md
@.planning/phases/01-vitec-api-connection/01-02-SUMMARY.md
@.planning/phases/01-vitec-api-connection/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify Railway environment variables</name>
  <files></files>
  <action>
Use Railway CLI to verify all required Vitec environment variables are set:

```bash
railway variables | grep -i vitec
```

Required variables (from research):
- VITEC_INSTALLATION_ID - Must be set for sync to work
- VITEC_HUB_BASE_URL - Should be production URL (https://hub.megler.vitec.net)
- VITEC_HUB_PRODUCT_LOGIN - Product login credential
- VITEC_HUB_ACCESS_KEY - Access key credential
- VITEC_ENVIRONMENT - Should be "production" or "prod"

If any are missing, document in summary but do not set them (user must configure credentials).

Also verify the backend service is running:
```bash
railway logs --service backend | head -50
```
  </action>
  <verify>
All required VITEC_* variables are present in Railway output.
If missing, the checkpoint task will request user configuration.
  </verify>
  <done>
Environment variables documented. If missing, user knows which ones to add.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Vitec API connection infrastructure (status endpoint, error handling, connection indicator)</what-built>
  <how-to-verify>
1. Visit production frontend: https://blissful-quietude-production.up.railway.app
2. Navigate to the Offices page (/offices)
3. Observe the Vitec connection status indicator near the sync button
4. Check the status:
   - If "Connected" (green): Proceed to step 5
   - If "Not configured" (yellow): Environment variables missing - add them in Railway
   - If "Error" (red): Check the error message and troubleshoot

5. If connected, click "Synkroniser Vitec" button
6. Observe:
   - Loading state appears during sync
   - Success toast shows sync counts (e.g., "Oppdatert 5 av 5 kontorer")
   - OR error toast shows actual error message (e.g., "Vitec Hub unauthorized")

7. Navigate to Employees page (/employees)
8. Click "Synkroniser Vitec" button
9. Observe:
   - Both office and employee sync run
   - Success shows both counts
   - OR error shows which step failed

Expected outcomes:
- Connection status reflects real API state
- Sync operations complete successfully OR show meaningful error messages
- Office and employee data appears after successful sync
  </how-to-verify>
  <resume-signal>
Type one of:
- "approved" - All checks passed, sync works
- "credentials-missing" - Need to add environment variables
- "auth-error" - API returns 401/403, credentials incorrect
- "other-error: [describe]" - Different issue encountered
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Document verification results</name>
  <files></files>
  <action>
Based on the checkpoint result, document the verification outcome:

If "approved":
- Record successful sync counts (offices, employees)
- Note any warnings or minor issues observed
- Confirm all Phase 1 success criteria met

If issues found:
- Document the specific error
- Add troubleshooting steps taken
- Note if this requires follow-up work

Update .planning/STATE.md with phase completion status.
  </action>
  <verify>
STATE.md updated to reflect phase status.
  </verify>
  <done>
Phase 1 verification documented. Either complete or with identified follow-up items.
  </done>
</task>

</tasks>

<verification>
Phase 1 success criteria (from ROADMAP.md):
1. Backend successfully authenticates with Vitec Next API
2. Admin can trigger employee sync and see Vitec employee data fetched
3. Admin can trigger office sync and see Vitec office data fetched
4. API errors surface clearly in UI (not silent failures)
</verification>

<success_criteria>
- All 4 phase success criteria verified in production
- Or clear documentation of what's blocking completion
- STATE.md updated with phase status
</success_criteria>

<output>
After completion, create `.planning/phases/01-vitec-api-connection/01-03-SUMMARY.md`
</output>
