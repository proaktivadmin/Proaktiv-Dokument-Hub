---
phase: 07-office-enhancements
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/alembic/versions/YYYYMMDD_add_salesscreen_fields.py
  - backend/app/models/office.py
  - backend/app/schemas/office.py
  - backend/app/config.py
autonomous: true
---

<objective>
Add SalesScreen integration fields to Office model and configuration.
</objective>

<context>
SalesScreen is a sales gamification platform. Only some offices have active agreements.
We need to track which offices are enabled and their team mapping.

See: 07-RESEARCH-SALESSCREEN.md for API research.
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create Alembic Migration</name>
  <files>backend/alembic/versions/YYYYMMDD_add_salesscreen_fields.py</files>
  <action>
    Add SalesScreen fields to offices table:
    ```python
    op.add_column('offices', sa.Column('salesscreen_enabled', sa.Boolean(), 
                  nullable=False, server_default='false'))
    op.add_column('offices', sa.Column('salesscreen_team_id', sa.String(100), 
                  nullable=True))
    op.create_index('idx_offices_salesscreen_enabled', 'offices', ['salesscreen_enabled'])
    ```
  </action>
</task>

<task type="auto">
  <name>Task 2: Update Office Model</name>
  <files>backend/app/models/office.py</files>
  <action>
    Add fields after Microsoft 365 section:
    ```python
    # SalesScreen Integration
    salesscreen_enabled: Mapped[bool] = mapped_column(
        Boolean, nullable=False, default=False
    )
    salesscreen_team_id: Mapped[str | None] = mapped_column(
        String(100), nullable=True
    )
    ```
    
    Add index:
    ```python
    Index("idx_offices_salesscreen_enabled", "salesscreen_enabled"),
    ```
  </action>
</task>

<task type="auto">
  <name>Task 3: Update Pydantic Schemas</name>
  <files>backend/app/schemas/office.py</files>
  <action>
    Add to OfficeCreate, OfficeUpdate, OfficeResponse:
    ```python
    salesscreen_enabled: bool = False
    salesscreen_team_id: str | None = None
    ```
  </action>
</task>

<task type="auto">
  <name>Task 4: Add Environment Variables</name>
  <files>backend/app/config.py</files>
  <action>
    Add SalesScreen config:
    ```python
    # SalesScreen Integration
    SALESSCREEN_API_URL: str = ""
    SALESSCREEN_CLIENT_ID: str = ""
    SALESSCREEN_CLIENT_SECRET: str = ""
    SALESSCREEN_ENABLED: bool = False  # Master switch
    ```
  </action>
</task>

<task type="auto">
  <name>Task 5: Run Migration</name>
  <files>-</files>
  <action>
    Run: alembic upgrade head
  </action>
</task>
</tasks>

<success_criteria>
- Migration runs successfully
- Office model has salesscreen fields
- Schemas include new fields
- Config has SalesScreen settings
- Existing offices unaffected (default: disabled)
</success_criteria>
